{% extends base_template|default:'base.html' %}
{% load humanize %}

{% block title %}Waitlist: {{ fleet.name }}{% endblock %}

{% block content %}
<!-- OPACITY-0 prevents flash of unstyled content -->
<div class="absolute inset-0 flex flex-col overflow-hidden bg-dark-950 opacity-0 animate-fade-in">

    <!-- HEADER BAR -->
    <div class="glass-header p-4 relative flex justify-center items-center z-20 shrink-0 min-h-[4rem]">

        <div class="flex items-center gap-6">
            <div class="bg-brand-500/10 p-2.5 rounded-lg border border-brand-500/20 hidden sm:block shadow-[0_0_15px_rgba(245,158,11,0.2)]">
                <span class="text-2xl">🛸</span>
            </div>
            <div class="text-center">
                <h1 class="heading-1 leading-none text-2xl md:text-3xl">{{ fleet.name }}</h1>
                <p class="text-xs text-slate-400 mt-2 flex justify-center items-center gap-3 font-mono">
                    <span class="label-text mb-0 text-[10px]">FC</span>
                    <span class="text-white font-bold">{{ fc_name }}</span>
                    <!-- STATUS INDICATOR -->
                    <span id="connection-status" class="w-2.5 h-2.5 rounded-full bg-slate-600 transition-all duration-500" title="Initializing..."></span>
                    {% if is_fc and not is_commander %}
                    <a href="{% url 'take_fleet_command' fleet.join_token %}" class="btn-danger py-0.5 px-2 text-[10px] uppercase font-bold tracking-wider">
                        Take Command
                    </a>
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="absolute right-4 top-1/2 -translate-y-1/2">
            <button onclick="document.getElementById('xup-modal').classList.remove('hidden')"
                    class="btn-primary py-2 px-6 shadow-brand-500/20">
                <span>➕</span> <span class="hidden md:inline">X-UP</span>
            </button>
        </div>
    </div>

    <!-- MAIN BOARD -->
    <div class="flex-grow overflow-x-auto overflow-y-hidden p-4 custom-scrollbar relative">
        <div class="flex gap-2 h-full min-w-max mx-auto w-fit">
            {% include 'waitlist/column.html' with title="X-UP" color="amber" entries=columns.pending id="pending" is_pending=True %}
            {% include 'waitlist/column.html' with title="LOGI" color="green" entries=columns.logi id="logi" %}
            {% include 'waitlist/column.html' with title="DPS" color="green" entries=columns.dps id="dps" %}
            {% include 'waitlist/column.html' with title="SNIPER" color="green" entries=columns.sniper id="sniper" %}
            {% include 'waitlist/column.html' with title="OTHER" color="green" entries=columns.other id="other" %}

            <!-- FLEET OVERVIEW COLUMN -->
            {% if can_view_overview %}
            <div class="w-80 flex flex-col glass-panel overflow-hidden h-full ml-2 border-white/10 shadow-xl bg-slate-900/90">
                <div class="bg-blue-600/10 border-b border-blue-500/20 p-3 flex justify-between items-center">
                    <h3 class="label-text text-blue-400 mb-0">Fleet Overview</h3>
                    <div class="flex items-center gap-2">
                        <!-- Updated ID for easier targeting -->
                        <span id="overview-pulse" class="w-1.5 h-1.5 rounded-full bg-slate-500 transition-colors duration-300"></span>
                        <span class="text-[10px] text-slate-500 font-mono" id="overview-text">Connecting...</span>
                    </div>
                </div>

                <!-- Inner Scroll Area -->
                <div class="flex-grow overflow-y-auto p-2 custom-scrollbar space-y-2" id="fleet-overview-content" data-has-error="false">
                    <div class="flex flex-col items-center justify-center h-full text-slate-500 opacity-50 space-y-2">
                        <div class="w-6 h-6 border-2 border-slate-500 border-t-transparent rounded-full animate-spin"></div>
                        <p class="text-xs">Waiting for stream...</p>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- PARTIALS -->
{% include 'waitlist/partials/xup_modal.html' %}
{% include 'waitlist/partials/update_modal.html' %}
{% include 'waitlist/partials/entry_modal.html' %}

<!-- SCRIPTS -->
{% include 'waitlist/partials/dashboard_scripts.html' %}

{% endblock %}